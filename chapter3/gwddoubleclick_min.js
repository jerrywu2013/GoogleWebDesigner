(function(){"use strict";var g=function(a,b){if(a.contains&&1==b.nodeType)return a==b||a.contains(b);if("undefined"!=typeof a.compareDocumentPosition)return a==b||Boolean(a.compareDocumentPosition(b)&16);for(;b&&a!=b;)b=b.parentNode;return b==a};function h(){this.g={}}h.prototype.add=function(a,b){var d="string"==typeof a?a:a.getString();this.g[d]||(this.g[d]=[]);this.g[d].push(b)};var k=function(a){var b=[],d="object"==typeof gwd&&"GwdId"in gwd,c;for(c in a.g)b.push(d?new gwd.GwdId(c):c);return b},l=function(a,b){return b?a.g["string"==typeof b?b:b.getString()]||[]:[]};function m(a,b){this.b=a;this.u=b;this.h=this.handleMetricEvent_.bind(this)}m.prototype.observe=function(a){if(a.nodeType==Node.ELEMENT_NODE)for(var b=k(this.b),d=0;d<b.length;d++){var c=n(b[d]);if(c&&g(a,c)){var e=l(this.b,b[d]);e&&e.forEach(function(a){c.addEventListener(a.event,this.h,!1)}.bind(this))}}};
var p=function(a,b){if(b.nodeType==Node.ELEMENT_NODE)for(var d=k(a.b),c=0;c<d.length;c++){var e=n(d[c]);if(e&&g(b,e)){var f=l(a.b,d[c]);f&&f.forEach(function(a){e.removeEventListener(a.event,this.h,!1)}.bind(a))}}};m.prototype.handleMetricEvent_=function(a){this.u(a)};var n=function(a){return"string"==typeof a?document.getElementById(a):a.getElement(document)};document.registerElement&&document.registerElement("gwd-metric-event",{prototype:Object.create(HTMLElement.prototype,{})});document.registerElement&&document.registerElement("gwd-metric-configuration",{prototype:Object.create(HTMLElement.prototype,{})});document.registerElement&&document.registerElement("gwd-exit",{prototype:Object.create(HTMLElement.prototype,{})});document.registerElement&&document.registerElement("gwd-timer",{prototype:Object.create(HTMLElement.prototype,{})});document.registerElement&&document.registerElement("gwd-doubleclick",{prototype:Object.create(HTMLElement.prototype,{createdCallback:{value:function(){this.r=this.handleEnablerInit_.bind(this);this.j=this.handleEnablerVisible_.bind(this);this.q=this.handleEnablerPageLoaded_.bind(this);this.n=this.handleEnablerExpandStart_.bind(this);this.m=this.handleEnablerCollapseStart_.bind(this);this.h=this.handleMetricEvent_.bind(this);this.o=this.handlePageTransitionEnd_.bind(this);this.p=this.handleResize_.bind(this);
this.c=this.d=!1;this.k=[];this.i=window.innerHeight>=window.innerWidth?1:2},enumerable:!0},attachedCallback:{value:function(){Enabler.addEventListener(studio.events.StudioEvent.EXPAND_START,this.n);Enabler.addEventListener(studio.events.StudioEvent.COLLAPSE_START,this.m);this.a=this.querySelector("[is=gwd-pagedeck]");this.a.addEventListener("pagetransitionend",this.o,!1);this.b=this.getMetricConfiguration_();this.s=new m(this.b,this.h);window.addEventListener("resize",this.p,!1)},enumerable:!0},
detachedCallback:{value:function(){Enabler.removeEventListener(studio.events.StudioEvent.INIT,this.r);Enabler.removeEventListener(studio.events.StudioEvent.VISIBLE,this.j);Enabler.removeEventListener(studio.events.StudioEvent.PAGE_LOADED,this.q);Enabler.removeEventListener(studio.events.StudioEvent.EXPAND_START,this.n);Enabler.removeEventListener(studio.events.StudioEvent.COLLAPSE_START,this.m);this.a.removeEventListener("pagetransitionend",this.o,!1);window.removeEventListener("resize",this.p,!1)},
enumerable:!0},initAd:{value:function(){this.onEnablerInit_(this.r)},enumerable:!0},exit:{value:function(a,b,d,c){Enabler.exit(a,b);c&&this.pauseMedia_();d&&this.goToPage()},enumerable:!0},exitOverride:{value:function(a,b,d,c){Enabler.exitOverride(a,b);c&&this.pauseMedia_();d&&this.goToPage()},enumerable:!0},incrementCounter:{value:function(a,b){Enabler.counter(a,b)},enumerable:!0},startTimer:{value:function(a){Enabler.startTimer(a)},enumerable:!0},stopTimer:{value:function(a){Enabler.stopTimer(a)},
enumerable:!0},reportManualClose:{value:function(){Enabler.reportManualClose()},enumerable:!0},getMetricConfiguration_:{value:function(){var a=this.querySelector("gwd-metric-configuration"),b=new h;if(a)for(var a=Array.prototype.slice.call(a.getElementsByTagName("gwd-metric-event")),d=0;d<a.length;d++){var c=a[d],e=c.getAttribute("source");if(e){var f=c.getAttribute("exit"),c={event:c.getAttribute("event"),w:c.getAttribute("metric")||f,v:c.hasAttribute("cumulative"),exit:f};b.add(this.getIdentifier_(e),
c)}}return b}},handleMetricEvent_:{value:function(a){var b=this.getIdentifier_(a.target),d=b+": "+a.type,c;i:{c=l(this.b,b);for(var e=0;e<c.length;e++)if(c[e].event==a.type){c=c[e];break i}c=void 0}c.exit&&a.detail&&a.detail.url?(Enabler.exitOverride(b+": "+c.exit,a.detail.url),a.detail.handled=!0,a.detail.collapse&&this.goToPage()):this.incrementCounter(c.w||d,c.v)}},onEnablerInit_:{value:function(a){Enabler.isInitialized()?a():Enabler.addEventListener(studio.events.StudioEvent.INIT,a)},enumerable:!1},
handleEnablerInit_:{value:function(){if(this.hasAttribute("polite-load"))this.onEnablerPageLoaded_(this.q);else this.onEnablerVisible_(this.j)},enumerable:!1},onEnablerVisible_:{value:function(a){Enabler.isVisible()?a():Enabler.addEventListener(studio.events.StudioEvent.VISIBLE,a)},enumerable:!1},handleEnablerVisible_:{value:function(a){var b;a&&(b=a.detail);(a=b)?(b=document.createEvent("CustomEvent"),b.initCustomEvent("adinitialized",!0,!0,a)):(b=document.createEvent("Event"),b.initEvent("adinitialized",
!0,!0));this.dispatchEvent(b);this.goToPage()},enumerable:!1},onEnablerPageLoaded_:{value:function(a){Enabler.isPageLoaded()?a():Enabler.addEventListener(studio.events.StudioEvent.PAGE_LOADED,a)},enumerable:!1},handleEnablerPageLoaded_:{value:function(){this.onEnablerVisible_(this.j)},enumerable:!1},goToPage:{value:function(a,b,d,c,e){var f=this.a.getPage(this.a.currentIndex);if(a=a?this.a.getPage(a):this.a.getDefaultPage())this.f=a.id,b&&(this.e={transition:b,duration:d,t:c,direction:e}),f&&a&&this.shouldExpand_(f,
a)?Enabler.requestExpand():f&&a&&this.shouldCollapse_(f,a)?Enabler.requestCollapse():(this.c=this.d=!1,this.goToNextPage_())},enumerable:!0},shouldExpand_:{value:function(a,b){return!this.d&&!a.hasAttribute("expanded")&&b.hasAttribute("expanded")}},shouldCollapse_:{value:function(a,b){return!this.c&&a.hasAttribute("expanded")&&!b.hasAttribute("expanded")}},handleEnablerExpandStart_:{value:function(){this.d=!0;Enabler.finishExpand();setTimeout(this.goToNextPage_.bind(this),30)},enumerable:!1},handleEnablerCollapseStart_:{value:function(){this.c=
!0;Enabler.finishCollapse();this.f||(this.reportManualClose(),this.f=this.a.getDefaultPage().id);setTimeout(this.goToNextPage_.bind(this),30)},enumerable:!1},handleResize_:{value:function(){if(!this.d&&!this.c){var a=window.innerHeight>=window.innerWidth?1:2;this.i!=a&&(this.i=a,(a=this.a.getPage(this.a.currentIndex))&&this.goToPage(a.id))}}},goToNextPage_:{value:function(){if(this.f){this.i=window.innerHeight>=window.innerWidth?1:2;var a=this.a.getOrientationSpecificPage(this.i,this.f);this.e?this.a.goToPage(a.id,
this.e.transition,this.e.duration,this.e.t,this.e.direction):this.a.goToPage(a.id)}this.e=this.f=void 0}},handlePageTransitionEnd_:{value:function(a){this.d?this.d=!1:this.c&&(this.c=!1);if(a.target==this.a){var b=a.detail;a=b.outgoingPage;b=b.incomingPage;a&&this.handlePageUnbound_(a);this.handlePageBound_(b)}},enumerable:!1},handlePageBound_:{value:function(a){this.s.observe(a);if((a=a.querySelectorAll("video"))&&0<a.length){var b=studio.video&&studio.video.Reporter,d=this.registerVideoElements_.bind(this);
this.l=Array.prototype.slice.call(a);b?d():Enabler.loadModule(studio.module.ModuleId.VIDEO,d)}},enumerable:!1},handlePageUnbound_:{value:function(a){p(this.s,a);(a=a.querySelectorAll("video"))&&0<a.length&&this.unregisterVideoElements_()},enumerable:!1},registerVideoElements_:{value:function(){for(var a,b;this.l.length;)if(b=this.l.shift(),a=this.getIdentifier_(b))studio.video.Reporter.attach(a,b,b.autoplay),this.k.push(a)},enumerable:!1},unregisterVideoElements_:{value:function(){for(this.l=[];this.k.length;)studio.video.Reporter.detach(this.k.shift())},
enumerable:!1},isGwdIdLoaded_:{value:function(){return"object"==typeof gwd&&"GwdId"in gwd},enumerable:!1},getIdentifier_:{value:function(a){return this.isGwdIdLoaded_()?(new gwd.GwdId(a)).getString():"string"==typeof a?a:a.id},enumerable:!1},pauseMedia_:{value:function(){Array.prototype.slice.call(this.a.querySelectorAll("video, gwd-youtube, audio")).forEach(function(a){a.pause()})},enumerable:!1}})});})()
